\documentclass{article}
\usepackage[utf8]{inputenc}

%%FOR CODES
\usepackage{listings,lstautogobble}
\usepackage{xcolor}
\usepackage{caption}

%%COLORES
\definecolor{realylightgray}{gray}{0.95}
\definecolor{RoyalBlue}{cmyk}{1, 0.50, 0, 0}
\definecolor{capri}{rgb}{0.0, 0.75, 1.0}
\definecolor{deepskyblue}{rgb}{0.0, 0.75, 1.0}
\definecolor{cobalt}{rgb}{0.0, 0.28, 0.67}
\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{amber}{rgb}{1.0, 0.49, 0.0}
\definecolor{darkorchid}{rgb}{0.6, 0.2, 0.8}

\lstset{
	showstringspaces=false,
	showtabs=false,
	showspaces=false,
	stringstyle=\ttfamily,
	frameround=ffff,
	frame=single,
	framextopmargin=4pt,
	framexbottommargin=4pt,
	rulecolor=\color{darkgray},
	gobble=12, %align text inside box left <-> right
	belowskip=2em,
	keepspaces=true,
	escapeinside={<@}{@>},
	columns=fullflexible
}

%%template for commands
\lstdefinestyle{commands}{
	basicstyle=\scriptsize\ttfamily,
	commentstyle=\ttfamily\itshape\color{gray},
	backgroundcolor=\color{realylightgray},
	keywords=[1]{elbrus@server, root@server},
	keywordstyle=[1]\color{cobalt},
	numbers=none,
	breaklines=false
}

%%template for files
\lstdefinestyle{files}{
	basicstyle=\ttfamily\footnotesize,
	commentstyle=\color{codegreen},
	backgroundcolor=\color{realylightgray},    
	deletekeywords=[1]{elbrus@server, root@server},                                       
	numbers=left,       
	numbersep=5pt,
	breaklines=true,                                                 
}

\captionsetup[lstlisting]{singlelinecheck=false, } %to align caption left
\lstset{style=commands}

\begin{document}
	\title{Elbrus Analytics - Bereitstellungshandbuch}
	\author{Tobias Schmidt}
	\date{\today}
	\maketitle
	\newpage
	
	Bekanntes Problem: Beim herauskopieren von Befehlen wird das Apostrophe Zeichen falsch kopiert und führt zu Eingabe Störungen. Lösung: Apostrophe Zeichen des kopierten Befehls händisch im Terminal mit Apostrophe Zeichen austauschen. 
	
	\section[Server Infrastruktur]{Server Infrastruktur}
	\subsection{SSH-Zugriff vorbereiten}
	
	\lstset{style=commands}
	\begin{lstlisting}[caption={Updaten vorhandener Packages.}]
		root@server:~$ yum update -y
	\end{lstlisting}
	
	\lstset{style=commands}
	\begin{lstlisting}[caption={Installieren des 'ssh' Packages.}]
		root@server:~$ yum install -y openssh-server
	\end{lstlisting}

	\lstset{style=commands}
	\begin{lstlisting}[caption={Starten des 'sshd' Services.}]
		root@server:~$ systemctl start sshd
	\end{lstlisting}

	\lstset{style=commands}
	\begin{lstlisting}[caption={Aktivieren des 'sshd' Services.}]
		root@server:~$ systemctl enable sshd
	\end{lstlisting}

	\lstset{style=commands}
	\begin{lstlisting}[caption={Anlegen des Users Elbrus.}]
		root@server:~$ useradd elbrus
	\end{lstlisting}

	\lstset{style=commands}
	\begin{lstlisting}[caption={Hinzufügen des Users Elbrus zu der Gruppe 'wheel'.}]
		root@server:~$ usermod -aG wheel elbrus
	\end{lstlisting}

	\lstset{style=commands}
	\begin{lstlisting}[caption={Ändern des Passwords für den User Elbrus.}]
		root@server:~$ passwd elbrus
		Changing password for user elbrus.
		New password:
		Retype new password:
		passwd: all authentication tokens updated successfully
		root@server:~$
	\end{lstlisting}

	\lstset{style=commands}
	\begin{lstlisting}[caption={Wechseln zu User elbrus.}]
		root@server:~$ su elbrus
	\end{lstlisting}
	\newpage
	
	\subsection{Initiale Server Konfiguration}

	\lstset{style=commands}
	\begin{lstlisting}[caption={Setzen der Zeitzone auf 'Europa/Wien'.}]
		elbrus@server:~$ sudo timedatectl set-timezone Europe/Vienna
	\end{lstlisting}

	\lstset{style=commands}
	\begin{lstlisting}[caption={Installieren von dem 'firewalld' Service.}]
		elbrus@server:~$ sudo dnf install firewalld
	\end{lstlisting}
	
	\subsubsection{Node.Js}
	
	\lstset{style=commands}
	\begin{lstlisting}[caption={Installieren des Framworks 'Node.Js'.}]
		elbrus@server:~$ sudo dnf -y module install nodejs:12
	\end{lstlisting}
	
	\subsubsection{Ablagestruktur}
	
	\lstset{style=commands}
	\begin{lstlisting}[caption={Anlegen der Verzeichnissstruktur.}]
		elbrus@server:~$ sudo mkdir /var/elbrus
		elbrus@server:~$ sudo chown -R elbrus:elbrus /var/elbrus
		elbrus@server:~$ cd /var/elbrus
		elbrus@server:~/var/elbrus$ mkdir shared keys
		elbrus@server:~/var/elbrus$ chmod -R 777 /var/elbrus/shared
	\end{lstlisting}
	\newpage

	% -------- Git Repos clonen
	\subsection{Git}
	
	\lstset{style=commands}
	\begin{lstlisting}[caption={Installieren von dem VCS 'git'.}]
		elbrus@server:~$ sudo yum install -y git
	\end{lstlisting}
	
	\lstset{style=commands}
	\subsubsection{Git - Erstellen der SSH-Keys}
	\begin{lstlisting}[caption={Wechseln des Verzeichnisses.}]
		elbrus@server:~$ cd /var/elbrus/keys
	\end{lstlisting}
	
	\lstset{style=commands}
	\begin{lstlisting}[caption={Erstellen des SSH-keys der für das Herunterladen der 'Database' benötigt wird.}]
		elbrus@server:~/var/elbrus/keys$ ssh-keygen -t rsa -b 2048 -f database_key -q -N ""
	\end{lstlisting}

	\lstset{style=commands}
	\begin{lstlisting}[caption={Erstellen des SSH-keys der für das Herunterladen des 'Capture-Device' benötigt wird.}]
		elbrus@server:~/var/elbrus/keys$ ssh-keygen -t rsa -b 2048 -f capture_device_key -q -N ""
	\end{lstlisting}

	\lstset{style=commands}
	\begin{lstlisting}[caption={Erstellen des SSH-keys der für das Herunterladen des 'Report-Generator' benötigt wird.}]
		elbrus@server:~/var/elbrus/keys$ ssh-keygen -t rsa -b 2048 -f\
		 report_generator_key -q -N ""
	\end{lstlisting}

	\lstset{style=commands}
	\begin{lstlisting}[caption={Erstellen des SSH-keys der für das Herunterladen des 'SNMP-Managers' benötigt wird.}]
		elbrus@server:~/var/elbrus/keys$ ssh-keygen -t rsa -b 2048 -f snmp_manager_key -q -N ""
	\end{lstlisting}

	\lstset{style=commands}
	\begin{lstlisting}[caption={Erstellen des SSH-keys der für das Herunterladen des 'SSH-Managers' benötigt wird.}]
		elbrus@server:~/var/elbrus/keys$ ssh-keygen -t rsa -b 2048 -f ssh_manager_key -q -N ""
	\end{lstlisting}
	
	\lstset{style=commands}
	\begin{lstlisting}[caption={Erstellen des SSH-keys der für das Herunterladen des 'Uptime-Monitors' benötigt wird.}]
		elbrus@server:~/var/elbrus/keys$ ssh-keygen -t rsa -b 2048 -f uptime_monitor_key -q -N ""
	\end{lstlisting}
	
	\lstset{style=commands}
	\begin{lstlisting}[caption={Erstellen des SSH-keys der für das Herunterladen des 'geo session finders' benötigt wird.}]
		elbrus@server:~/var/elbrus/keys$ ssh-keygen -t rsa -b 2048\
		 -f geo_session_finder_key -q -N ""
	\end{lstlisting}
	
	\lstset{style=commands}
	\begin{lstlisting}[caption={Erstellen des SSH-keys der für das Herunterladen der 'API' benötigt wird.}]
		elbrus@server:~/var/elbrus/keys$ ssh-keygen -t rsa -b 2048 -f api_key -q -N ""
	\end{lstlisting}
	
	\lstset{style=commands}
	\begin{lstlisting}[caption={Erstellen des SSH-keys der für das Herunterladen des 'Webinterfaces' benötigt wird.}]
		elbrus@server:~/var/elbrus/keys$ ssh-keygen -t rsa -b 2048 -f webinterface_key -q -N ""
	\end{lstlisting}

	Bevor mit der Installation vorgefahren werden kann müssen die soeben angelegten SSH-Keys an "keys@Elbrus-Analytics.at" gesendet werden. Bitte beachten Sie, dass Ihre Email-Adresse Sie als berechtigten Nutzer ausweist.
	
	\subsubsection{Git - Clonen der Software}

	\lstset{style=commands}
	\begin{lstlisting}[caption={Wechseln des Verzeichnisses.}]
		elbrus@server:~$ cd /var/elbrus
	\end{lstlisting}
	
	\lstset{style=commands}
	\begin{lstlisting}[caption={Clonen der Datenbank Software.}]
		elbrus@server:~/var/elbrus$ git clone git@github.com:Elbrus-Analytics/database.git\
		 --config core.sshCommand="ssh -i ./keys/database_key"
	\end{lstlisting}
	
	\lstset{style=commands}
	\begin{lstlisting}[caption={Clonen der 'Capture-Device' Software.}]
		elbrus@server:~/var/elbrus$ git clone git@github.com:Elbrus-Analytics/capture-device.git\
		 --config core.sshCommand="ssh -i ./keys/capture_device_key"
		elbrus@server:~/var/elbrus$ mkdir capture
		elbrus@server:~/var/elbrus$ cp -a capture-device/src/. capture
		elbrus@server:~/var/elbrus$ rm -rfd capture-device
	\end{lstlisting}
	
	%\lstset{style=commands}
	%\begin{lstlisting}[caption={Clonen der Packet-Importer Software}]
	%	elbrus@server:~/var/elbrus$ git clone https://github.com/\
	%	Elbrus-Analytics/database.git
	%\end{lstlisting}

	\lstset{style=commands}
	\begin{lstlisting}[caption={Clonen der 'Report-Generator' Software.}]
		elbrus@server:~/var/elbrus$ git clone git@github.com:Elbrus-Analytics/\
		report-generator.git --config core.sshCommand="ssh -i ./keys/report_generator_key"
	\end{lstlisting}
	
	\lstset{style=commands}
	\begin{lstlisting}[caption={Clonen der 'SNMP-Manager' Software.}]
		elbrus@server:~/var/elbrus$ git clone git@github.com:Elbrus-Analytics/snmp-manager.git\
		 --config core.sshCommand="ssh -i ./keys/snmp_manager_key"
	\end{lstlisting}

	\lstset{style=commands}
	\begin{lstlisting}[caption={Clonen der 'SSH-Manager' Software.}]
		elbrus@server:~/var/elbrus$ git clone git@github.com:Elbrus-Analytics/ssh-manager.git\
		 --config core.sshCommand="ssh -i ./keys/ssh_manager_key"
	\end{lstlisting}
	
	\lstset{style=commands}
	\begin{lstlisting}[caption={Clonen der 'Uptime-Monitor' Software.}]
		elbrus@server:~/var/elbrus$ git clone git@github.com:Elbrus-Analytics/api.git\
		 --config core.sshCommand="ssh -i ./keys/uptime_monitor_key"
	\end{lstlisting}

	\lstset{style=commands}
	\begin{lstlisting}[caption={Clonen 'geo session finders' Software.}]
		elbrus@server:~/var/elbrus/keys$ git clone git@github.com:Elbrus-Analytics/\
		geo_session_finder.git --config core.sshCommand="ssh -i ./keys/geo_session_finder_key"
	\end{lstlisting}
	
	\lstset{style=commands}
	\begin{lstlisting}[caption={Clonen der API Software.}]
		elbrus@server:~/var/elbrus$ git clone git@github.com:Elbrus-Analytics/api.git\
		 --config core.sshCommand="ssh -i ./keys/api_key"
	\end{lstlisting}

	\lstset{style=commands}
	\begin{lstlisting}[caption={Clonen der Packet-Importer Software}]
		elbrus@server:~/var/elbrus$ git clone git@github.com:Elbrus-Analytics/webinterface.git\
		 --config core.sshCommand="ssh -i ./keys/webinterface_key"
	\end{lstlisting}
	\newpage
	
	\subsection{Python}
	\subsubsection{1 - Automatische Installation}

	\lstset{style=commands}
	\begin{lstlisting}[caption={Ausführen des 'pythonSourceInstall.sh' Scripts.}]
		elbrus@server:~/var/elbrus$ sudo bash report-generator/pythonSourceInstall.sh
	\end{lstlisting}
	
	\subsubsection{2 - Manuel Installation}
	
	\lstset{style=commands}
	\begin{lstlisting}[caption={Installieren von benötigten Packeten und Abhängigkeiten.}]
		elbrus@server:~$ cd /var/elbrus
		elbrus@server:~/var/elbrus$ sudo dnf install gcc openssl-devel bzip2-devel\
		libffi-devel zlib-devel wget make -y
	\end{lstlisting}
	
	\lstset{style=commands}
	\begin{lstlisting}[caption={Herunterladen der Source Datei.}]
		elbrus@server:~/var/elbrus$ wget https://www.python.org/ftp/python/\
		3.10.0/Python-3.10.0.tar.xz
	\end{lstlisting}
	
	\lstset{style=commands}
	\begin{lstlisting}[caption={Extrahieren der installierten Datei.}]
		elbrus@server:~/var/elbrus$ tar -xf Python-3.10.2.tar.xz
	\end{lstlisting}
	
	\lstset{style=commands}
	\begin{lstlisting}[caption={Wechseln zu source Verzeichniss. Und ausführen des Konfigurations Scripts.}]
		elbrus@server:~/var/elbrus$ cd Python-3.10.0 && ./configure --enable-optimizations
	\end{lstlisting}

	\lstset{style=commands}
	\begin{lstlisting}[caption={Starten des build Prozesses.}]
		elbrus@server:~/var/elbrus/Python-3.10.0$ cd make -j $(nproc)
	\end{lstlisting}
	
	\lstset{style=commands}
	\begin{lstlisting}[caption={Installieren von Python.}]
		elbrus@server:~/var/elbrus/Python-3.10.0$ sudo make install
	\end{lstlisting}

	\lstset{style=commands}
	\begin{lstlisting}[caption={Löschen der kompremierten Python Datei.}]
		elbrus@server:~/var/elbrus/Python-3.10.0$ cd .. && rm Python-3.10.0.tar.xz
	\end{lstlisting}

	\subsubsection{Upgrade von 'pip'}

	\lstset{style=commands}
	\begin{lstlisting}[caption={Upgraden von 'pip'.}]
		elbrus@server:~$ /usr/local/bin/python3.10 -m pip install --upgrade pip
	\end{lstlisting}

	\subsection{Rust}
	
	\lstset{style=commands}
	\begin{lstlisting}[caption={Installieren von GNU Compiler Collection.}]
		elbrus@server:~$ sudo dnf install gcc -y
	\end{lstlisting}
	
	\lstset{style=commands}
	\begin{lstlisting}[caption={Installieren von Rust.}]
		elbrus@server:~$ curl --proto '=https' --tlsv1.2 -sSf \
		https://sh.rustup.rs/ | sh
		 
		...
		 
		default host triple: x86_64-unknown-linux-gnu
		default toolchain: stable (default)
		profile: default
		modify PATH variable: yes
		
		1) Proceed with installation (default)
		2) Customize installation
		3) Cancel installation
		>1
		
		...
		
		<@\textcolor{codegreen}{stable-x86\_64-unknown-linux-gnu installed}@> - rustc 1.62.1 (e092d0b6b 2022-07-16)
		
		
		Rust is installed now. Great!
		
		To get started you may need to restart your current shell.
		This would reload your PATH environment variable to include
		Cargo's bin directory ($HOME/.cargo/bin).
		
		To configure your current shell, run:
		source "$HOME/.cargo/env"
		elbrus@server:~$
	\end{lstlisting}
	
	\lstset{style=commands}
	\begin{lstlisting}[caption={Laden der Variablen aus dem Terminal Profil.}]
		elbrus@server:~$ source ~/.profile
	\end{lstlisting}

	\lstset{style=commands}
	\begin{lstlisting}[caption={Hinzufügen des Befehls Cargo zu dem Pfad.}]
		elbrus@server:~$ source ~/.cargo/env
	\end{lstlisting}
	\newpage
	
	% --------- Verbindung wenn Software auf verschiedene Server aufgeteilt ist ------------
	%\section{SSH-Keys}
	%\input{SSH-Keys.tex}
	%\newpage
	
	% --------- DATENBANK ---------
	\section{Datenbank}
	\input{database.tex}
	\newpage
	
	% ----------- Globale Konfiguration ---------
	\section{Globale Konfiguration}
	\input{global-configuration.tex}
	\newpage
	
	% --------- CAPTURE ---------
	\section{Aufzeichnen der Daten}
	\input{capture.tex}
	\newpage
	
	% --------- PACKET CAPTURE IMPORTER ---------
	\section{Packet Capture Importer}
	\input{importer.tex}
	\newpage
	
	% --------- REPORT GENERATOR ---------
	\section{Report Generator}
	\input{report-generator.tex}
	\newpage
	
	
	% --------- SNMP MANAGER ---------
	\section{SNMP Manager}
	\input{snmp-manager.tex}
	\newpage
	
	% --------- SSH MANAGER ---------
	\section{SSH Manager}
	\input{ssh-manager.tex}
	\newpage
	
	% --------- UPTIME MONITOR ---------
	\section{Uptime Monitor}
	\input{uptime-monitor.tex}
	\newpage
	
	% --------- GEO SESSION FINDER ---------
	\section{Geo Session finder}
	\input{geo-session.tex}
	\newpage
	
	% --------- office365 ---------
	\section{office365}
	\input{office365.tex}
	\newpage
	
	% --------- API ---------
	\section{API}
	\input{api.tex}
	\newpage
	
	% --------- Webinterface ---------
	\section{Webinterface}
	\newpage
\end{document}